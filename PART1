SELECT min(payroll_year),max(payroll_year)
FROM czechia_payroll cpay ;

SELECT min(date_from),max(date_from)
FROM czechia_price cp;
   
CREATE OR REPLACE TABLE t_zuzana_polakova_project_SQL_primary_final AS (
SELECT
cp.id AS food_id, cp.category_code AS food_category, cp.value AS food_price, cp.date_from AS price_measured_from, cpc.name, cpc.price_value, cpc.price_unit, 
cpay.id AS payroll_id, cpay.industry_branch_code, cpay.value AS average_wages, cpay.payroll_year
FROM czechia_price AS cp
JOIN czechia_payroll cpay ON cpay.payroll_year = YEAR (date_from) 
JOIN czechia_price_category cpc ON cp.category_code = cpc.code
WHERE cpay.value_type_code = 5958 And cp.region_code IS NULL)
;

CREATE OR REPLACE INDEX i_czechia_payroll__value ON czechia_payroll(value);

SELECT average_wages, industry_branch_code, payroll_year
FROM t_zuzana_polakova_project_sql_primary_final tzppspf 
WHERE  industry_branch_code = "A"
GROUP BY payroll_year 
ORDER BY payroll_year ;

SELECT 
    industry_branch_code, average_wages, payroll_year,
payroll_year + 1 AS next_year
FROM t_zuzana_polakova_project_sql_primary_final tzppspf;

CREATE OR REPLACE INDEX t_zuzana_polakova_project_sql_primary_final_year on t_zuzana_polakova_project_sql_primary_final(payroll_year);
CREATE OR REPLACE INDEX t_zuzana_polakova_project_sql_primary_final_industry_code on t_zuzana_polakova_project_sql_primary_final(industry_branch_code);

DROP INDEX t_zuzana_polakova_project_sql_primary_final_industry_code on t_zuzana_polakova_project_sql_primary_final;

CREATE OR REPLACE INDEX t_zuzana_polakova_project_sql_primary_final_food_price on t_zuzana_polakova_project_sql_primary_final(food_price);
CREATE OR REPLACE INDEX t_zuzana_polakova_project_sql_primary_final_food_category on t_zuzana_polakova_project_sql_primary_final(food_category);

SELECT *
FROM t_zuzana_polakova_project_sql_primary_final tzppspf ;

SELECT tzppspf.industry_branch_code, tzppspf.average_wages, tzppspf.payroll_year, tzppspf2. payroll_year + 1 as year_next,round( ( tzppspf.average_wages - tzppspf2.average_wages) / tzppspf2.average_wages * 100, 2 ) as wage_growth
FROM t_zuzana_polakova_project_sql_primary_final tzppspf  
JOIN t_zuzana_polakova_project_sql_primary_final tzppspf2 
    ON tzppspf.payroll_id = tzppspf2.payroll_id
    AND tzppspf.payroll_year = tzppspf2. payroll_year + 1
    AND tzppspf.payroll_year < 2019;

  
